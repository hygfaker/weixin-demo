<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.minstone.mobile.mp.wechat.message.dao.WxMessagePushDao">

    <resultMap id="BaseResultMap" type="com.minstone.mobile.mp.wechat.message.domain.WxMessagePush">
        <id column="PUSH_CODE" jdbcType="VARCHAR" property="pushCode"/>
        <result column="PUBLIC_CODE" jdbcType="VARCHAR" property="publicCode"/>
        <result column="PUSH_NAME" jdbcType="VARCHAR" property="pushName"/>
        <result column="LATITUDE" jdbcType="FLOAT" property="latitude"/>
        <result column="LONGITUDE" jdbcType="FLOAT" property="longitude"/>
        <result column="RADIUS" jdbcType="FLOAT" property="radius"/>
        <result column="CONTENT" jdbcType="VARCHAR" property="content"/>
        <result column="PUSH_FLAG" jdbcType="INTEGER" property="pushFlag"/>
        <result column="CREATOR" jdbcType="VARCHAR" property="creator"/>
        <result column="CREATE_DATE" jdbcType="VARCHAR" property="createDate"/>
        <result column="MODIFY_DATE" jdbcType="VARCHAR" property="modifyDate"/>
        <result column="MODIFYER" jdbcType="VARCHAR" property="modifyer"/>
        <result column="DEL_FLAG" jdbcType="INTEGER" property="delFlag"/>
    </resultMap>

    <insert id="insertSelective" parameterType="com.minstone.mobile.mp.wechat.message.domain.WxMessagePush">
        insert into MP_YY_MSG_PUSH
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="pushCode != null">
                PUSH_CODE,
            </if>
            <if test="publicCode != null">
                PUBLIC_CODE,
            </if>
            <if test="pushName != null">
                PUSH_NAME,
            </if>
            <if test="latitude != null">
                LATITUDE,
            </if>
            <if test="longitude != null">
                LONGITUDE,
            </if>
            <if test="radius != null">
                RADIUS,
            </if>
            <if test="content != null">
                CONTENT,
            </if>
            <if test="pushFlag != null">
                PUSH_FLAG,
            </if>
            <if test="creator != null">
                CREATOR,
            </if>
            <if test="createDate != null">
                CREATE_DATE,
            </if>
            <if test="modifyDate != null">
                MODIFY_DATE,
            </if>
            <if test="modifyer != null">
                MODIFYER,
            </if>
            <if test="delFlag != null">
                DEL_FLAG,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="pushCode != null">
                #{pushCode,jdbcType=VARCHAR},
            </if>
            <if test="publicCode != null">
                #{publicCode,jdbcType=VARCHAR},
            </if>
            <if test="pushName != null">
                #{pushName,jdbcType=VARCHAR},
            </if>
            <if test="latitude != null">
                #{latitude,jdbcType=FLOAT},
            </if>
            <if test="longitude != null">
                #{longitude,jdbcType=FLOAT},
            </if>
            <if test="radius != null">
                #{radius,jdbcType=FLOAT},
            </if>
            <if test="content != null">
                #{content,jdbcType=VARCHAR},
            </if>
            <if test="pushFlag != null">
                #{pushFlag,jdbcType=INTEGER},
            </if>
            <if test="creator != null">
                #{creator,jdbcType=VARCHAR},
            </if>
            <if test="createDate != null">
                #{createDate,jdbcType=VARCHAR},
            </if>
            <if test="modifyDate != null">
                #{modifyDate,jdbcType=VARCHAR},
            </if>
            <if test="modifyer != null">
                #{modifyer,jdbcType=VARCHAR},
            </if>
            <if test="delFlag != null">
                #{delFlag,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>

    <delete id="delete">
        update MP_YY_MSG_PUSH
        set DEL_FLAG = 1 WHERE
        PUSH_CODE = #{pushCode,jdbcType=VARCHAR}
        AND
        1=1
    </delete>

    <delete id="forceDelete">
        delete from MP_YY_MSG_PUSH WHERE
        <if test="pushCode != null">
            PUSH_CODE = #{pushCode,jdbcType=VARCHAR}
            AND
        </if>
        1=1
    </delete>

    <delete id="deleteBatch">
        update MP_YY_MSG_PUSH
        set DEL_FLAG = 1
        WHERE PUSH_CODE IN
        <foreach collection="array" index="index" separator="," open="(" close=")" item="item">
            #{item}
        </foreach>
        AND 1=1
    </delete>

    <delete id="forceDeleteBatch">
        delete from MP_YY_MSG_PUSH WHERE PUSH_CODE IN
        <foreach collection="array" index="index" separator="," open="(" close=")" item="item">
            #{item}
        </foreach>
        AND 1=1
    </delete>

    <update id="updateByPrimaryKey" parameterType="com.minstone.mobile.mp.wechat.message.domain.WxMessagePush">
        update MP_YY_MSG_PUSH
        <set>
            <if test="publicCode != null">
                PUBLIC_CODE = #{publicCode,jdbcType=VARCHAR},
            </if>
            <if test="pushName != null">
                PUSH_NAME = #{pushName,jdbcType=VARCHAR},
            </if>
            <if test="latitude != null">
                LATITUDE = #{latitude,jdbcType=FLOAT},
            </if>
            <if test="longitude != null">
                LONGITUDE = #{longitude,jdbcType=FLOAT},
            </if>
            <if test="radius != null">
                RADIUS = #{radius,jdbcType=FLOAT},
            </if>
            <if test="content != null">
                CONTENT = #{content,jdbcType=VARCHAR},
            </if>
            <if test="pushFlag != null">
                PUSH_FLAG = #{pushFlag,jdbcType=INTEGER},
            </if>
            <if test="creator != null">
                CREATOR = #{creator,jdbcType=VARCHAR},
            </if>
            <if test="createDate != null">
                CREATE_DATE = #{createDate,jdbcType=VARCHAR},
            </if>
            <if test="modifyDate != null">
                MODIFY_DATE = #{modifyDate,jdbcType=VARCHAR},
            </if>
            <if test="modifyer != null">
                MODIFYER = #{modifyer,jdbcType=VARCHAR},
            </if>
            <if test="delFlag != null">
                DEL_FLAG = #{delFlag,jdbcType=INTEGER},
            </if>
        </set>
        where PUSH_CODE = #{pushCode,jdbcType=VARCHAR}
    </update>

    <update id="updateFlag">
        update MP_YY_MSG_PUSH set PUSH_FLAG = #{pushFlag,jdbcType=INTEGER} WHERE
        <if test="pushCode !=null ">
            PUSH_CODE = #{pushCode,jdbcType=VARCHAR}
            AND
        </if>
        1=1
    </update>

    <sql id="Base_Column_List">
        PUSH_CODE,
        PUBLIC_CODE,
        PUSH_NAME,
        LATITUDE,
        LONGITUDE,
        RADIUS,
        CONTENT,
        PUSH_FLAG,
        CREATOR,
        CREATE_DATE,
        MODIFY_DATE,
        MODIFYER,
        DEL_FLAG
    </sql>

    <select id="select" resultMap="BaseResultMap"
            parameterType="com.minstone.mobile.mp.wechat.message.domain.WxMessagePush">
        select *
        from MP_YY_MSG_PUSH WHERE
        <if test="pushCode != null">
            PUSH_CODE = #{pushCode,jdbcType=VARCHAR}
            AND
        </if>
        <if test="pushName != null">
            PUSH_NAME = #{pushName,jdbcType=VARCHAR}
            AND
        </if>
        1=1
    </select>

    <select id="selectAll" resultMap="BaseResultMap"
            parameterType="com.minstone.mobile.mp.wechat.message.domain.WxMessagePush">
        select
        <include refid="Base_Column_List"/>
        from MP_YY_MSG_PUSH WHERE
        <if test="publicCode != null">
            PUBLIC_CODE = #{publicCode,jdbcType=VARCHAR}
            AND
        </if>
        <if test="pushFlag != null">
            PUSH_FLAG = #{pushFlag,jdbcType=INTEGER}
            AND
        </if>
        DEL_FLAG = 0
        AND
        1 = 1
    </select>

    <select id="selectMessageByOpenIdAndUserCode" resultMap="BaseResultMap">
       select * from MP_YY_MSG_PUSH m
        where m.PUBLIC_CODE
        in (select PUBLIC_CODE from MP_YY_PUBLIC where OPEN_ID=#{openId})
        and m.PUSH_CODE
        not in (select PUSH_CODE from MP_YY_MSG_PUSH_RECORD where USER_CODE=#{userCode})
    </select>


</mapper>