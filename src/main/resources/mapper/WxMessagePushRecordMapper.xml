<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.minstone.mobile.mp.wechat.message.dao.WxMessagePushRecordDao">
    <resultMap id="BaseResultMap" type="com.minstone.mobile.mp.wechat.message.domain.WxMessagePushRecord">
        <id column="RECORD_CODE" jdbcType="VARCHAR" property="recordCode"/>
        <result column="PUSH_CODE" jdbcType="VARCHAR" property="pushCode"/>
        <result column="USER_CODE" jdbcType="VARCHAR" property="userCode"/>
        <result column="PUSH_DATE" jdbcType="VARCHAR" property="pushDate"/>
        <result column="PUSH_STATE" jdbcType="INTEGER" property="pushState"/>
        <result column="DEL_FLAG" jdbcType="INTEGER" property="delFlag"/>
    </resultMap>

    <sql id="Base_Column_List">
    RECORD_CODE, PUSH_CODE, USER_CODE, PUSH_DATE, PUSH_STATE, DEL_FLAG
  </sql>

    <select id="select" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from MP_YY_MSG_PUSH_RECORD where
        <if test="recordCode != null">
            RECORD_CODE = #{recordCode,jdbcType=VARCHAR}
            AND
        </if>
        <if test="pushCode != null">
            PUSH_CODE = #{pushCode,jdbcType=VARCHAR}
            AND
        </if>
        <if test="userCode != null">
            USER_CODE = #{userCode,jdbcType=VARCHAR}
            AND
        </if>
        <if test="delFlag != null">
            DEL_FLAG = #{delFlag,jdbcType=INTEGER}
            AND
        </if>
        1=1
    </select>

    <select id="selectByUserCode" parameterType="java.lang.String" resultType="java.lang.String">
        select PUSH_CODE
        from MP_YY_MSG_PUSH_RECORD where
        USER_CODE = #{userCode,jdbcType=VARCHAR}
        AND
        1=1
    </select>

    <select id="selectRecord" resultMap="BaseResultMap">
    SELECT r.* FROM MP_YY_MSG_PUSH_RECORD r , MP_YY_MSG_PUSH m , MP_YY_PUBLIC p WHERE
      p.OPEN_ID = #{openId,jdbcType=VARCHAR} AND
      p.PUBLIC_CODE = m.PUBLIC_CODE AND
      m.PUSH_CODE = r.PUSH_CODE AND
      r.USER_CODE = #{userCode,jdbcType=VARCHAR} AND
      1=1
  </select>

    <select id="selectRecordByDate" resultType="java.util.Map">
        select distinct(left(PUSH_DATE,#{len})) as pushDate,
        count(*) as total from MP_YY_MSG_PUSH_RECORD where
        <if test="pushCode != null">
            PUSH_CODE = #{pushCode,jdbcType=VARCHAR}
            AND
        </if>
        left(PUSH_DATE,#{len}) <![CDATA[>=]]>  #{startDate}
        and left(PUSH_DATE,#{len}) <![CDATA[<=]]> #{endDate}
        GROUP BY left(PUSH_DATE,#{len})
    </select>

    <delete id="delete">
        update MP_YY_MSG_PUSH_RECORD
        set DEL_FLAG = 1
        where
        <if test="recordCode != null">
            RECORD_CODE = #{recordCode,jdbcType=VARCHAR}
            AND
        </if>
        <if test="pushCode != null">
            PUSH_CODE = #{pushCode,jdbcType=VARCHAR}
            AND
        </if>
        <if test="userCode != null">
            USER_CODE = #{userCode,jdbcType=VARCHAR}
            AND
        </if>
        1=1
    </delete>

    <delete id="forceDelete">
        delete from MP_YY_MSG_PUSH_RECORD
        where
        <if test="recordCode != null">
            RECORD_CODE = #{recordCode,jdbcType=VARCHAR}
            AND
        </if>
        <if test="pushCode != null">
            PUSH_CODE = #{pushCode,jdbcType=VARCHAR}
            AND
        </if>
        <if test="userCode != null">
            USER_CODE = #{userCode,jdbcType=VARCHAR}
            AND
        </if>
        1=1
    </delete>

    <insert id="insert" parameterType="com.minstone.mobile.mp.wechat.message.domain.WxMessagePushRecord">
    insert into MP_YY_MSG_PUSH_RECORD (RECORD_CODE, PUSH_CODE, USER_CODE, 
      PUSH_DATE, PUSH_STATE, DEL_FLAG
      )
    values (#{recordCode,jdbcType=VARCHAR}, #{pushCode,jdbcType=VARCHAR}, #{userCode,jdbcType=VARCHAR}, 
      #{pushDate,jdbcType=VARCHAR}, #{pushState,jdbcType=INTEGER}, #{delFlag,jdbcType=INTEGER}
      )
  </insert>

    <insert id="insertSelective" parameterType="com.minstone.mobile.mp.wechat.message.domain.WxMessagePushRecord">
        insert into MP_YY_MSG_PUSH_RECORD
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="recordCode != null">
                RECORD_CODE,
            </if>
            <if test="pushCode != null">
                PUSH_CODE,
            </if>
            <if test="userCode != null">
                USER_CODE,
            </if>
            <if test="pushDate != null">
                PUSH_DATE,
            </if>
            <if test="pushState != null">
                PUSH_STATE,
            </if>
            <if test="delFlag != null">
                DEL_FLAG,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="recordCode != null">
                #{recordCode,jdbcType=VARCHAR},
            </if>
            <if test="pushCode != null">
                #{pushCode,jdbcType=VARCHAR},
            </if>
            <if test="userCode != null">
                #{userCode,jdbcType=VARCHAR},
            </if>
            <if test="pushDate != null">
                #{pushDate,jdbcType=VARCHAR},
            </if>
            <if test="pushState != null">
                #{pushState,jdbcType=INTEGER},
            </if>
            <if test="delFlag != null">
                #{delFlag,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>

    <update id="update" parameterType="com.minstone.mobile.mp.wechat.message.domain.WxMessagePushRecord">
        update MP_YY_MSG_PUSH_RECORD
        <set>
            <if test="pushCode != null">
                PUSH_CODE = #{pushCode,jdbcType=VARCHAR},
            </if>
            <if test="userCode != null">
                USER_CODE = #{userCode,jdbcType=VARCHAR},
            </if>
            <if test="pushDate != null">
                PUSH_DATE = #{pushDate,jdbcType=VARCHAR},
            </if>
            <if test="pushState != null">
                PUSH_STATE = #{pushState,jdbcType=INTEGER},
            </if>
            <if test="delFlag != null">
                DEL_FLAG = #{delFlag,jdbcType=INTEGER},
            </if>
        </set>
        where RECORD_CODE = #{recordCode,jdbcType=VARCHAR}
    </update>

</mapper>